<uwpcControls:UniversalPage
    x:Class="ActionNote.App.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ActionNote.App"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:swipe="using:Universal.UI.Xaml.Controls"
    xmlns:uwpcControls="using:UWPCore.Framework.Controls"
    xmlns:uwpcConverters="using:UWPCore.Framework.Converters"
    xmlns:localViewModels="using:ActionNote.App.ViewModels"
    xmlns:commonModels="using:ActionNote.Common.Models"
    xmlns:commonConverters="using:ActionNote.Common.Converters"
    xmlns:localHelpers="using:ActionNote.Common.Helpers"
    mc:Ignorable="d"
    x:Name="root"
    d:DataContext="{d:DesignData Source=/SampleData/MainViewModelSampleData.xaml}">
    <uwpcControls:UniversalPage.Resources>
        <Storyboard x:Name="IntroArrowBlick">
            <DoubleAnimationUsingKeyFrames AutoReverse="True" RepeatBehavior="Forever" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="image">
                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:1" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:2.5" Value="1">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <CircleEase EasingMode="EaseInOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <DataTemplate x:Key="NoteListDataTemplate">
            <Grid Margin="4" Padding="16,0,8,0" RightTapped="NoteListItem_RightTapped" Tapped="NoteListItem_Tapped" Holding="NoteListItem_Holding" Tag="{Binding }"
                  Background="#01888888"> <!-- Give it a light color, because Transparent is BADLY clickable/touchable -->
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="{Binding Color, Converter={StaticResource colorToBrushConv}}" Width="{Binding IsImportant, Converter={StaticResource importantToWidthConv}}"
                        CornerRadius="{Binding IsImportant, Converter={StaticResource importantToCornerRadiusConv}}" HorizontalAlignment="Center" VerticalAlignment="Stretch" Margin="0,4,0,4" />
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="{Binding Title}" TextWrapping="Wrap" FontSize="24" FontWeight="SemiBold" Margin="4" />
                        <Grid Grid.Column="1" Visibility="{Binding IsHidden, Converter={StaticResource boolToVisConv}}" VerticalAlignment="Top" Margin="4,4" Width="32" Height="32">
                            <FontIcon Glyph="{StaticResource ActionCenter}" FontSize="21" Margin="0,-1,0,0" />
                            <Path Width="20" Height="20" Stretch="Fill" Opacity="0.8" Fill="{ThemeResource SystemBaseHighColor}" Data="F1 M 0,18 18,0 19,1 1,19 Z"/>
                        </Grid>
                        <FontIcon Grid.Column="2" Glyph="{StaticResource Attach}" Visibility="{Binding HasAttachement, Converter={StaticResource boolToVisConv}}" Width="32" Height="32" VerticalAlignment="Top" Margin="4,4" />
                        <FontIcon Grid.Column="3" Glyph="{StaticResource Info}" Visibility="{Binding IsImportant, Converter={StaticResource boolToVisConv}}" Width="32" Height="32" VerticalAlignment="Top" Margin="4,4"
                                  RenderTransformOrigin="0.5,0.5">
                            <FontIcon.RenderTransform>
                                <RotateTransform Angle="180" />
                            </FontIcon.RenderTransform>
                        </FontIcon>
                    </Grid>
                    <RichTextBlock localHelpers:RichTextBindingHelper.Text="{Binding Content}" TextWrapping="Wrap" Margin="4" Visibility="{Binding Content, Converter={StaticResource emptyStringToVisConv}}"
                                   Tapped="RichTextTapped" IsTapEnabled="True" IsTextSelectionEnabled="False" Tag="{Binding }" MaxHeight="{Binding ElementName=root, Path=DataContext.NoteItemMaxHeight}" TextTrimming="CharacterEllipsis"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
        <!--<DataTemplate x:Key="NoteListDataTemplate">
            <Grid RightTapped="NoteListItem_RightTapped" Tapped="NoteListItem_Tapped" Holding="NoteListItem_Holding" Tag="{Binding }"
                  Background="{Binding Color, Converter={StaticResource colorToBrushConv}}" Margin="8,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Width="{Binding IsImportant, Converter={StaticResource importantToWidthConv}}"/>

                <Border Grid.Column="1" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Margin="16,2,2,2">
                    <StackPanel Background="{ThemeResource SystemControlHighlightListLowBrush}" Padding="4">
                        <TextBlock Text="{Binding Title}" TextWrapping="Wrap" FontSize="24" FontWeight="SemiBold" Margin="4" />
                        <RichTextBlock localHelpers:RichTextBindingHelper.Text="{Binding Content}" TextWrapping="Wrap" Margin="4" Visibility="{Binding Content, Converter={StaticResource emptyStringToVisConv}}"
                                   Tapped="RichTextTapped" IsTapEnabled="True" IsTextSelectionEnabled="False" Tag="{Binding }" MaxHeight="{Binding ElementName=root, Path=DataContext.NoteItemMaxHeight}" TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>-->
        <Storyboard x:Name="SyncAnimation">
            <DoubleAnimationUsingKeyFrames EnableDependentAnimation="True" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)" Storyboard.TargetName="SyncIcon">
                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="360">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <CubicEase EasingMode="EaseInOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <DiscreteDoubleKeyFrame KeyTime="0:0:2.01" Value="0" />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

    </uwpcControls:UniversalPage.Resources>

    <Grid x:Name="RootLayout" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <uwpcControls:PageHeader>
            <uwpcControls:PageHeader.HeaderContent>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" x:Uid="MainTitle" Text="NOTES" Style="{ThemeResource PageTitleTextBlockStyle}" TextWrapping="NoWrap"/>
                    <AppBarButton Grid.Column="1" x:Uid="ChangeSize" Width="54" Icon="{Binding NotesExpandStateIcon}" Command="{Binding ToggleNoteItemViewState}" ToolTipService.ToolTip="Change size" />
                    <AppBarButton Grid.Column="2" x:Uid="SortBy" Width="54" Icon="Sort" ToolTipService.ToolTip="Sort">
                        <AppBarButton.Flyout>
                            <MenuFlyout x:Name="ColorFlyout" MenuFlyoutPresenterStyle="{StaticResource CommandBarMenuFlyoutPresenterTopStyle}">
                                <MenuFlyoutItem x:Uid="SortByDate" Command="{Binding SortCommand}" CommandParameter="date" />
                                <MenuFlyoutItem x:Uid="SortByCategory" Command="{Binding SortCommand}" CommandParameter="category" />
                            </MenuFlyout>
                        </AppBarButton.Flyout>
                    </AppBarButton>
                </Grid>
            </uwpcControls:PageHeader.HeaderContent>
        </uwpcControls:PageHeader>

        <CommandBar x:Name="bottomBar" Grid.Row="2" VerticalAlignment="Bottom" HorizontalContentAlignment="Stretch">
            <AppBarButton x:Uid="Sync" Label="Synchronize" Command="{Binding SyncCommand}">
                <AppBarButton.Icon>
                    <FontIcon x:Name="SyncIcon" Glyph="{StaticResource Refresh}" RenderTransformOrigin="0.5,0.5" >
                        <FontIcon.RenderTransform>
                            <CompositeTransform/>
                        </FontIcon.RenderTransform>
                    </FontIcon>
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarSeparator Style="{StaticResource ThinAppBarSeparatorStyle}" />
            <AppBarButton x:Uid="Add" Icon="Add" Command="{Binding AddCommand}"/>
            <CommandBar.SecondaryCommands>
                <AppBarButton x:Uid="DeleteAll" Command="{Binding ClearCommand}"/>
            </CommandBar.SecondaryCommands>
        </CommandBar>

        <Grid Grid.Row="1" EntranceNavigationTransitionInfo.IsTargetElement="True">
            <Button x:Name="FocusElement" Width="1" Height="1" Opacity="0" TabIndex="0" />
            <ProgressBar IsIndeterminate="True" VerticalAlignment="Top" Visibility="{Binding ShowProgress, Converter={StaticResource boolToVisConv}}" />

            <!-- intro arrow -->
            <Image x:Name="image" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="64,8" Source="/Assets/Images/arrow.png" Width="80"
                   Visibility="{Binding ShowIntoArrow, Converter={StaticResource boolToVisConv}}"/>

            <swipe:SwipeListView ItemsSource="{Binding NoteItems}" SelectedItem="{Binding SelectedNote, Mode=TwoWay}" Padding="0,16"
                      ItemTemplate="{StaticResource NoteListDataTemplate}" ItemSwipe="SwipeListView_ItemSwipe" SelectionMode="None" ItemLeftBehavior="Disabled">
                <swipe:SwipeListView.ItemRightContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Path Data="F1M20.25,29.25L18,29.25 18,11.25 20.25,11.25z M15.75,29.25L13.5,29.25 13.5,11.25 15.75,11.25z M11.25,4.5L18,4.5 18,2.25 11.25,2.25z M11.25,29.25L9,29.25 9,11.25 11.25,11.25z M24.75,6.75L4.5,6.75 4.5,32.625C4.5,32.93 4.611,33.193 4.834,33.416 5.057,33.639 5.32,33.75 5.625,33.75L23.625,33.75C23.93,33.75 24.193,33.639 24.416,33.416 24.639,33.193 24.75,32.93 24.75,32.625z M29.25,6.75L27,6.75 27,32.625C27,33.094 26.912,33.533 26.736,33.943 26.561,34.354 26.32,34.711 26.016,35.016 25.711,35.32 25.354,35.561 24.943,35.736 24.533,35.912 24.094,36 23.625,36L5.625,36C5.156,36 4.717,35.912 4.307,35.736 3.896,35.561 3.539,35.32 3.234,35.016 2.93,34.711 2.689,34.354 2.514,33.943 2.338,33.533 2.25,33.094 2.25,32.625L2.25,6.75 0,6.75 0,4.5 9,4.5 9,2.25C9,1.934 9.059,1.641 9.176,1.371 9.293,1.102 9.454,0.864 9.659,0.659 9.864,0.454 10.102,0.293 10.371,0.176 10.641,0.059 10.934,0 11.25,0L18,0C18.316,0 18.609,0.059 18.879,0.176 19.148,0.293 19.386,0.454 19.591,0.659 19.796,0.864 19.957,1.102 20.074,1.371 20.191,1.641 20.25,1.934 20.25,2.25L20.25,4.5 29.25,4.5z" Fill="White" Height="24" Stretch="Uniform" Width="24" Margin="19,0,19,0"/>
                            <TextBlock x:Uid="/ActionNote.Common/Resources/Swipe/Delete" Text="Delete" Foreground="White" Style="{ThemeResource BodyTextBlockStyle}" TextAlignment="Center" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </swipe:SwipeListView.ItemRightContentTemplate>
                <swipe:SwipeListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Padding" Value="0" />
                    </Style>
                </swipe:SwipeListView.ItemContainerStyle>
            </swipe:SwipeListView>
        </Grid>
    </Grid>
</uwpcControls:UniversalPage>
